'use strict';

var eventemitter3 = require('eventemitter3');

var l=(t=>(t.HTTPS="https://www.youtube.com/iframe_api",t.HTTP="http://www.youtube.com/iframe_api",t))(l||{}),n=(i=>(i[i.UNSTARTED=-1]="UNSTARTED",i[i.ENDED=0]="ENDED",i[i.PLAYING=1]="PLAYING",i[i.PAUSED=2]="PAUSED",i[i.BUFFERING=3]="BUFFERING",i[i.CUED=5]="CUED",i))(n||{});function h(u,e,t){return new Promise((s,a)=>{let r=document.createElement("script");r.async=!0,r.src=u,Object.entries(e||{}).forEach(([p,y])=>{r.setAttribute(p,y);}),r.onload=()=>{r.onerror=r.onload=null,s(r);},r.onerror=()=>{r.onerror=r.onload=null,a(new Error(`Failed to load ${u}`));},(t||document.head||document.getElementsByTagName("head")[0]).appendChild(r);})}var o=[],d=class extends eventemitter3.EventEmitter{_element=void 0;_options;_api=void 0;_player=void 0;_ready=!1;_autoplay=!1;_queue=[];_interval=void 0;_start=void 0;videoId;destroyed=!1;constructor(e,t){super();let s=typeof e=="string"?document.querySelector(e):e;if(!s)throw new Error("No element was found.");this._element=s,this._options=Object.assign({width:640,height:360,autoplay:!1,captions:void 0,controls:!0,keyboard:!0,fullscreen:!0,annotations:!0,modestBranding:!1,relatedVideos:!0,timeUpdateFrequency:0,playsInline:!0,start:0,debug:!1,host:"https://www.youtube-nocookie.com"},t||{}),this._startInterval=this._startInterval.bind(this),this._stopInterval=this._stopInterval.bind(this),this.on("playing",this._startInterval),this.on("unstarted",this._stopInterval),this.on("ended",this._stopInterval),this.on("paused",this._stopInterval),this.on("buffering",this._stopInterval),this._loadIframeApi((a,r)=>{if(r)return this._destroy(new Error("YouTube Iframe API failed to load."));a&&(this._api=a),this.videoId&&this.load(this.videoId,this._autoplay,this._start);});}_debug(...e){if(this._options.debug){let t=new Date().toLocaleString("en",{timeStyle:"medium"});console.log(`${t}: `,...e);}}_loadIframeApi(e){if(window.YT&&typeof window.YT.Player=="function")return e(window.YT);if(o.push(e),!document.querySelector(`script[src="${l}"]`)){let a=window.location.protocol==="http"?"HTTP":"HTTPS";h(l[a]).catch(r=>{for(;o.length;){let i=o.shift();i&&i(void 0,r);}});}let s=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{for(typeof s=="function"&&s();o.length;){let a=o.shift();a&&a(window.YT,void 0);}};}_createPlayer(e){if(this.destroyed||!this._element||!this._api?.Player||!this._options)return;let t=this._options,s=this._api?.Player;this._player=new s(this._element,{width:t.width||640,height:t.height||360,videoId:e,host:t.host||"https://www.youtube-nocookie.com",playerVars:{autoplay:t.autoplay?1:0,cc_load_policy:t.captions!==void 0?t.captions?1:0:void 0,hl:t.captions!==void 0&&t.captions!==""?t.captions:void 0,cc_lang_pref:t.captions!==null&&t.captions!==""?t.captions:void 0,controls:t.controls?2:0,disablekb:t.keyboard?0:1,enablejsapi:1,fs:t.fullscreen?1:0,iv_load_policy:t.annotations?1:3,modestbranding:t.modestBranding?1:0,origin:window.location.origin,playsinline:t.playsInline?1:0,rel:t.relatedVideos?1:0,wmode:"opaque",start:t.start,loop:0,showinfo:1},events:{onReady:()=>this._onReady(),onStateChange:a=>this._onStateChange(a),onPlaybackQualityChange:a=>this._onPlaybackQualityChange(a),onPlaybackRateChange:a=>this._onPlaybackRateChange(a),onError:a=>this._onError(a)}});}load(e,t=!1,s=0){if(!this.destroyed&&(this.videoId=e,this._autoplay=t,this._start=s,!!this._api)){if(!this._player){this._createPlayer(e);return}this._ready&&(t?this._player.loadVideoById({videoId:e,startSeconds:s}):this._player.cueVideoById({videoId:e,startSeconds:s}));}}play(){this._ready?this._player?.playVideo():this._queueCommand("play");}pause(){this._ready?this._player?.pauseVideo():this._queueCommand("pause");}stop(){this._ready?this._player?.stopVideo():this._queueCommand("stop");}set currentTime(e){this._ready?this._player?.seekTo(e,!0):this._queueCommand("seek",e);}seek(e){this._ready?this._player?.seekTo(e,!0):this._queueCommand("seek",e);}set volume(e){this._ready?this._player?.setVolume(e):this._queueCommand("setVolume",e);}setVolume(e){this._ready?this._player?.setVolume(e):this._queueCommand("setVolume",e);}get volume(){return this._ready&&this._player?.getVolume()||0}getVolume(){return this._ready&&this._player?.getVolume()||0}set muted(e){this._ready?e?this._player?.mute():this._player?.unMute():this._queueCommand(e?"mute":"unMute");}mute(){this._ready?this._player?.mute():this._queueCommand("mute");}unMute(){this._ready?this._player?.unMute():this._queueCommand("unMute");}get muted(){return this._ready&&this._player?.isMuted()||!1}isMuted(){return this._ready&&this._player?.isMuted()||!1}set size({width:e,height:t}){this._ready?this._player?.setSize(e,t):this._queueCommand("setSize",e,t);}setSize(e,t){this._ready?this._player?.setSize(e,t):this._queueCommand("setSize",e,t);}get size(){return {width:parseInt(this._ready&&this._player?.getIframe().width||"0")||0,height:parseInt(this._ready&&this._player?.getIframe().height||"0")||0}}getSize(){return {width:parseInt(this._ready&&this._player?.getIframe().width||"0")||0,height:parseInt(this._ready&&this._player?.getIframe().height||"0")||0}}set playbackRate(e){[.25,.5,1,1.5,2].includes(e)&&(this._ready?this._player?.setPlaybackRate(e):this._queueCommand("setPlaybackRate",e));}setPlaybackRate(e){this._ready?this._player?.setPlaybackRate(e):this._queueCommand("setPlaybackRate",e);}set playbackQuality(e){this._ready?this._player?.setPlaybackQuality(e):this._queueCommand("setPlaybackQuality",e);}setPlaybackQuality(e){this._ready?this._player?.setPlaybackQuality(e):this._queueCommand("setPlaybackQuality",e);}get playbackQuality(){return this._ready&&this._player?.getPlaybackQuality()||"default"}getPlaybackQuality(){return this._ready&&this._player?.getPlaybackQuality()||"default"}get availablePlaybackQualities(){return this._ready&&this._player?.getAvailableQualityLevels()||[]}getAvailablePlaybackQualities(){return this._ready&&this._player?.getAvailableQualityLevels()||[]}get playbackRate(){return this._ready&&this._player?.getPlaybackRate()||1}getPlaybackRate(){return this._ready&&this._player?.getPlaybackRate()||1}get availablePlaybackRates(){return this._ready&&this._player?.getAvailablePlaybackRates()||[1]}getAvailablePlaybackRates(){return this._ready&&this._player?.getAvailablePlaybackRates()||[1]}get duration(){return this._ready&&this._player?.getDuration()||0}getDuration(){return this._ready&&this._player?.getDuration()||0}get progress(){return this._ready&&this._player?.getVideoLoadedFraction()||0}getProgress(){return this._ready&&this._player?.getVideoLoadedFraction()||0}get state(){return this._ready&&n[this._player?.getPlayerState()]||"unstarted"}getState(){return this._ready&&n[this._player?.getPlayerState()]||"unstarted"}get currentTime(){return this._ready&&this._player?.getCurrentTime()||0}getCurrentTime(){return this._ready&&this._player?.getCurrentTime()||0}get youTubeInstance(){return this._ready&&this._player}getYouTubeInstance(){return this._ready&&this._player}get percentageWatched(){return this._ready&&this.getCurrentTime()/this.getDuration()||0}getPercentageWatched(){return this._ready&&this.getCurrentTime()/this.getDuration()||0}destroy(){this._destroy();}_destroy(e){this.destroyed||(this.destroyed=!0,this._options.debug&&e&&console.error(e.message),this._player&&(this._player.stopVideo&&this._player.stopVideo(),this._player.destroy()),this.videoId=void 0,this._element=void 0,this._options={},this._api=void 0,this._player=void 0,this._ready=!1,this._queue=[],this._stopInterval(),this.removeListener("playing",this._startInterval),this.removeListener("paused",this._stopInterval),this.removeListener("buffering",this._stopInterval),this.removeListener("unstarted",this._stopInterval),this.removeListener("ended",this._stopInterval),e&&this.emit("error",e));}_queueCommand(e,...t){this.destroyed||this._queue.push([e,t]);}_flushQueue(){for(;this._queue.length;){let e=this._queue.shift();if(!e)return;this[e[0]].apply(this,e[1]);}}_onReady(){this.destroyed||(this.emit("ready"),this._ready=!0,this.load(this.videoId,this._autoplay,this._start),this._flushQueue());}_onStateChange(e){if(this.destroyed)return;let t=n[e.data].toLowerCase();if(this._debug("STATE CHANGED:",t),t)["paused","buffering","ended"].includes(t)&&this._onTimeUpdate(),this.emit(t),this.emit("stateChange",t),["unstarted","playing","cued"].includes(t)&&this._onTimeUpdate();else throw new Error(`${"Unrecognized state change event"}: ${e}`)}_onPlaybackQualityChange(e){this.destroyed||this.emit("playbackQualityChange",e.data);}_onPlaybackRateChange(e){this.destroyed||this.emit("playbackRateChange",e.data);}_onError(e){if(this.destroyed)return;let t=e.data;if(t===5&&console.error("The request content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred."),t===101||t===150||t===100||t===2)return this.emit("unplayable",this.videoId);this._destroy(new Error(`${"Unknown error code"}: ${t}`));}_onTimeUpdate(){this.destroyed||this.emit("timeupdate",this.getCurrentTime());}_startInterval(){this._interval=setInterval(()=>this._onTimeUpdate(),this._options.timeUpdateFrequency);}_stopInterval(){this._interval&&(clearInterval(this._interval),this._interval=void 0);}};

module.exports = d;
